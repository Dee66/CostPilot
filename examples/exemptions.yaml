# CostPilot Policy Exemptions Configuration
# 
# This file defines temporary exemptions from policy violations.
# All exemptions require justification and expiration dates.

version: "1.0"

metadata:
  owner: "platform-team@example.com"
  last_reviewed: "2025-12-06"

exemptions:
  # NAT Gateway exemption for production VPC
  - id: "EXE-001"
    policy_name: "nat_gateway_limit"
    resource_pattern: "nat_gateways"
    justification: "Production VPC requires multiple NAT gateways for high availability across 3 AZs"
    expires_at: "2026-06-30"
    approved_by: "ops-lead@example.com"
    created_at: "2025-12-01T10:00:00Z"
    ticket_ref: "JIRA-1234"

  # EC2 instance type exemption with wildcard
  - id: "EXE-002"
    policy_name: "ec2_allowed_families"
    resource_pattern: "module.legacy_app.*"
    justification: "Legacy application requires specific instance families until migration completes Q2 2026"
    expires_at: "2026-06-30"
    approved_by: "architecture@example.com"
    created_at: "2025-12-01T11:30:00Z"
    ticket_ref: "ARCH-789"

  # S3 lifecycle exemption for specific bucket
  - id: "EXE-003"
    policy_name: "s3_lifecycle_required"
    resource_pattern: "module.data.aws_s3_bucket.archive"
    justification: "Archive bucket requires custom lifecycle policy being developed separately"
    expires_at: "2026-01-31"
    approved_by: "data-team@example.com"
    created_at: "2025-12-01T14:00:00Z"
    ticket_ref: "DATA-456"

  # Lambda concurrency exemption
  - id: "EXE-004"
    policy_name: "lambda_concurrency_required"
    resource_pattern: "module.processing.aws_lambda_function.worker"
    justification: "Worker function needs unbounded concurrency during migration period"
    expires_at: "2026-03-01"
    approved_by: "backend-lead@example.com"
    created_at: "2025-12-01T15:45:00Z"
    ticket_ref: "BACKEND-321"

  # Global budget exemption (temporary)
  - id: "EXE-005"
    policy_name: "global_budget"
    resource_pattern: "global"
    justification: "Q1 2026 infrastructure expansion approved by CFO - temporary budget increase"
    expires_at: "2026-03-31"
    approved_by: "cfo@example.com"
    created_at: "2025-12-01T16:00:00Z"
    ticket_ref: "FIN-999"

# Best Practices:
# 1. All exemptions MUST have expiration dates (max 1 year from creation)
# 2. Justification must clearly explain business need
# 3. Approved_by should be appropriate authority (team lead, architect, etc.)
# 4. Use wildcard patterns (module.*) for applying to multiple resources
# 5. Review exemptions regularly and remove expired ones
# 6. Link to tracking tickets for audit trail
